# Wedding Photo Sharing App - Handover Document

> **æœ€çµ‚æ›´æ–°æ—¥**: 2024å¹´12æœˆ  
> **å¯¾è±¡èª­è€…**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã€æ–°è¦é–‹ç™ºè€…  
> **é‡è¦**: ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯**å®Ÿéš›ã«å­˜åœ¨ã™ã‚‹ã‚³ãƒ¼ãƒ‰**ã®ã¿ã‚’æ­£è§£ã¨ã—ã¦è¨˜è¿°ã—ã¦ã„ã¾ã™ã€‚å®Ÿè£…ã•ã‚Œã¦ã„ãªã„æ©Ÿèƒ½ã¯ã€Œæœªå®Ÿè£…ã€ã¨æ˜è¨˜ã—ã¦ã„ã¾ã™ã€‚

---

## ğŸ“‹ ç›®æ¬¡

1. [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦](#1-ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦)
2. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ & ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ](#2-ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£--ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ )
3. [ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ« & ã‚¹ã‚­ãƒ¼ãƒ](#3-ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«--ã‚¹ã‚­ãƒ¼ãƒ)
4. [ä¸»è¦æ©Ÿèƒ½ã®ãƒ­ã‚¸ãƒƒã‚¯è§£èª¬](#4-ä¸»è¦æ©Ÿèƒ½ã®ãƒ­ã‚¸ãƒƒã‚¯è§£èª¬)
5. [ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é–‹ç™ºè€…ã¸ã®å®Ÿè£…ã‚¬ã‚¤ãƒ‰](#5-ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é–‹ç™ºè€…ã¸ã®å®Ÿè£…ã‚¬ã‚¤ãƒ‰)
6. [ç’°å¢ƒå¤‰æ•° & è¨­å®š](#6-ç’°å¢ƒå¤‰æ•°--è¨­å®š)
7. [é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](#7-é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—)

---

## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

### 1.1 ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç›®çš„

çµå©šå¼ã®å†™çœŸå…±æœ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã€‚ã‚²ã‚¹ãƒˆãŒå†™çœŸã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã€æ–°éƒæ–°å©¦ãŒç®¡ç†ãƒ»é–²è¦§ã§ãã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

**ä¸»è¦ãªä¾¡å€¤ææ¡ˆ:**
- **ã‚²ã‚¹ãƒˆå‚åŠ å‹æ¼”å‡º**: ã‚²ã‚¹ãƒˆãŒå†™çœŸã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æ€ã„å‡ºã‚’å…±æœ‰
- **å“ã”ã¨ã®ã‚¢ãƒ«ãƒãƒ **: æ–°éƒæ–°å©¦ãŒå„å“ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨å†™çœŸã‚’è¨­å®šã—ã€ã‚²ã‚¹ãƒˆãŒãã®å“ã®ã‚¢ãƒ«ãƒãƒ ã‚’é–²è¦§
- **ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚²ãƒ¼ãƒˆæ©Ÿèƒ½**: ã‚²ã‚¹ãƒˆãŒãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å®Œäº†ã™ã‚‹ã“ã¨ã§ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒè§£é™¤ã•ã‚Œã‚‹ä»•çµ„ã¿

### 1.2 ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ãƒ¼ãƒ«

`lib/types/schema.ts` ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ãƒ¼ãƒ«:

```typescript
type UserRole = 
  | 'SUPER_ADMIN'      // ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚¢ãƒ‰ãƒŸãƒ³ï¼ˆã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®ç®¡ç†ï¼‰
  | 'VENUE_ADMIN'      // ä¼šå ´ç®¡ç†è€…ï¼ˆä¼šå ´ã”ã¨ã®ç®¡ç†ï¼‰
  | 'PLANNER'          // ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ï¼ˆæŒ™å¼ã®ç®¡ç†ï¼‰
  | 'COUPLE'           // æ–°éƒæ–°å©¦ï¼ˆè‡ªåˆ†ã®æŒ™å¼ã®ç®¡ç†ï¼‰
  | 'GUEST';           // ã‚²ã‚¹ãƒˆï¼ˆå†™çœŸã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»é–²è¦§ï¼‰
```

**å„ãƒ­ãƒ¼ãƒ«ã®ã‚¢ã‚¯ã‚»ã‚¹ç¯„å›²:**

| ãƒ­ãƒ¼ãƒ« | ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªãƒ«ãƒ¼ãƒˆ | ä¸»ãªæ©Ÿèƒ½ |
|--------|---------------------|----------|
| `GUEST` | `/guest/*` | å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€ã‚®ãƒ£ãƒ©ãƒªãƒ¼é–²è¦§ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼é€ä¿¡ |
| `COUPLE` | `/couple/*` | å“è¨­å®šã€å†™çœŸç®¡ç†ã€ã‚®ãƒ£ãƒ©ãƒªãƒ¼é–²è¦§ |
| `PLANNER` | `/dashboard/*` | æŒ™å¼ç®¡ç†ã€ã‚²ã‚¹ãƒˆç®¡ç†ã€ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ç¢ºèª |
| `VENUE_ADMIN` | `/dashboard/[venueId]/*` | ä¼šå ´è¨­å®šã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç† |
| `SUPER_ADMIN` | `/admin/*` | ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®ç®¡ç†ã€ä¼šå ´ç®¡ç† |

### 1.3 æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰:**
- **Next.js 15.1.0** (App Router)
- **React 18.3.1**
- **TypeScript 5.5.0** (strict mode)
- **Tailwind CSS 3.4.4** (ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ)
- **Shadcn/ui** (Radix UIãƒ™ãƒ¼ã‚¹ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª)
- **Framer Motion 12.25.0** (ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³)
- **Sonner 2.0.7** (Toasté€šçŸ¥)
- **Canvas Confetti 1.9.4** (ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ)
- **JSZip 3.10.1** & **file-saver 2.0.5** (ZIPãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰)
- **React Responsive Masonry 2.1.0** (Masonryãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ)
- **Zod 4.3.5** (ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³)
- **SWR 2.3.8** (ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°ã€ä¸€éƒ¨ã§ä½¿ç”¨)
- **Zustand 5.0.9** (çŠ¶æ…‹ç®¡ç†ã€ä¸€éƒ¨ã§ä½¿ç”¨)

**é–‹ç™ºãƒ„ãƒ¼ãƒ«:**
- **ESLint** (Next.jsæ¨™æº–è¨­å®š)
- **PostCSS** & **Autoprefixer**
- **TypeScript** (strict mode)

---

## 2. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ & ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

### 2.1 Service Repositoryãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¡ç”¨

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯**Service Repositoryãƒ‘ã‚¿ãƒ¼ãƒ³**ã‚’æ¡ç”¨ã—ã¦ãŠã‚Šã€UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Œå…¨ã«åˆ†é›¢ã—ã¦ã„ã¾ã™ã€‚

#### 2.1.1 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³

```mermaid
graph TB
    subgraph "UI Layer (app/)"
        A[Page Components]
        B[Layout Components]
    end
    
    subgraph "Service Layer (lib/services/)"
        C[mock/weddingService.ts]
        D[mock/venueService.ts]
        E[mock/photoService.ts]
        F[mock/guestService.ts]
        G[api.ts - Legacy]
    end
    
    subgraph "Type Definitions"
        H[schema.ts]
    end
    
    A --> C
    A --> D
    A --> E
    A --> F
    B --> C
    B --> D
    
    C --> H
    D --> H
    E --> H
    F --> H
    
    style C fill:#e1f5ff
    style D fill:#e1f5ff
    style E fill:#e1f5ff
    style F fill:#e1f5ff
    style H fill:#fff4e1
```

#### 2.1.2 ç–çµåˆã®å®Ÿç¾æ–¹æ³•

**UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€Œãƒ‡ãƒ¼ã‚¿ã®å–å¾—æ–¹æ³•ã€ã‚’çŸ¥ã‚Šã¾ã›ã‚“:**

```typescript
// âŒ æ‚ªã„ä¾‹ï¼ˆç›´æ¥MOCKãƒ‡ãƒ¼ã‚¿ã‚’å‚ç…§ï¼‰
const MOCK_WEDDING = { weddingDate: new Date(), ... };
const daysUntil = calculateDaysUntil(MOCK_WEDDING.weddingDate);

// âœ… è‰¯ã„ä¾‹ï¼ˆServiceå±¤çµŒç”±ï¼‰
import { getWeddingDate } from '@/lib/services/mock/weddingService';

const [weddingDate, setWeddingDate] = useState<Date | null>(null);
useEffect(() => {
  const loadData = async () => {
    const date = await getWeddingDate(MOCK_WEDDING_ID);
    setWeddingDate(date);
  };
  loadData();
}, []);
```

**ãƒ¡ãƒªãƒƒãƒˆ:**
1. **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…ã®å¤‰æ›´ãŒUIã«å½±éŸ¿ã—ãªã„**: Serviceé–¢æ•°ã®å†…éƒ¨å®Ÿè£…ã‚’å¤‰æ›´ã™ã‚‹ã ã‘ã§ã€UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯å¤‰æ›´ä¸è¦
2. **ãƒ†ã‚¹ãƒˆãŒå®¹æ˜“**: Serviceå±¤ã‚’ãƒ¢ãƒƒã‚¯åŒ–ã—ã¦ã€UIã®å‹•ä½œã‚’ãƒ†ã‚¹ãƒˆã§ãã‚‹
3. **å‹å®‰å…¨æ€§**: `schema.ts` ã§å®šç¾©ã•ã‚ŒãŸå‹ãŒå¼·åˆ¶ã•ã‚Œã‚‹ãŸã‚ã€å‹ã‚¨ãƒ©ãƒ¼ã‚’æ—©æœŸç™ºè¦‹ã§ãã‚‹

### 2.2 ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
guest-link/
â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”œâ”€â”€ (auth)/                   # èªè¨¼é–¢é€£ï¼ˆãƒ«ãƒ¼ãƒˆã‚°ãƒ«ãƒ¼ãƒ—ï¼‰
â”‚   â”‚   â””â”€â”€ login/
â”‚   â”œâ”€â”€ (dashboard)/              # ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ãƒ»ä¼šå ´ç®¡ç†è€…ç”¨ï¼ˆãƒ«ãƒ¼ãƒˆã‚°ãƒ«ãƒ¼ãƒ—ï¼‰
â”‚   â”‚   â””â”€â”€ dashboard/
â”‚   â”‚       â”œâ”€â”€ (auth)/           # èªè¨¼ãŒå¿…è¦ãªãƒšãƒ¼ã‚¸
â”‚   â”‚       â””â”€â”€ (main)/           # èªè¨¼å¾Œã®ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
â”‚   â”‚           â””â”€â”€ [venueId]/   # ä¼šå ´IDå‹•çš„ãƒ«ãƒ¼ãƒˆ
â”‚   â”œâ”€â”€ (guest)/                  # ã‚²ã‚¹ãƒˆç”¨ï¼ˆãƒ«ãƒ¼ãƒˆã‚°ãƒ«ãƒ¼ãƒ—ï¼‰
â”‚   â”‚   â””â”€â”€ guest/
â”‚   â”‚       â”œâ”€â”€ (entry)/          # å…¥å£ç”»é¢ï¼ˆãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰èªè¨¼ï¼‰
â”‚   â”‚       â”œâ”€â”€ (onboarding)/     # ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰
â”‚   â”‚       â””â”€â”€ (main)/           # ãƒ¡ã‚¤ãƒ³æ©Ÿèƒ½ï¼ˆã‚®ãƒ£ãƒ©ãƒªãƒ¼ï¼‰
â”‚   â”œâ”€â”€ admin/                    # ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚¢ãƒ‰ãƒŸãƒ³ç”¨
â”‚   â”œâ”€â”€ couple/                   # æ–°éƒæ–°å©¦ç”¨
â”‚   â”‚   â”œâ”€â”€ page.tsx              # ãƒ›ãƒ¼ãƒ ç”»é¢
â”‚   â”‚   â”œâ”€â”€ tables/               # å“è¨­å®š
â”‚   â”‚   â”œâ”€â”€ gallery/              # å†™çœŸã‚®ãƒ£ãƒ©ãƒªãƒ¼
â”‚   â”‚   â””â”€â”€ login/                # ãƒ­ã‚°ã‚¤ãƒ³
â”‚   â””â”€â”€ layout.tsx                # ãƒ«ãƒ¼ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚
â”œâ”€â”€ components/                   # å†åˆ©ç”¨å¯èƒ½ãªUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ ui/                       # Shadcn/uiã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ admin/                    # ç®¡ç†ç”»é¢ç”¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ guest/                    # ã‚²ã‚¹ãƒˆç”¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â””â”€â”€ schema.ts            # å…±é€šå‹å®šç¾©ï¼ˆæœ€é‡è¦ï¼‰
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ mock/                 # Mock Serviceå±¤ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…å¾…ã¡ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ weddingService.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ venueService.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ photoService.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ guestService.ts
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ api.ts                # Legacy APIå±¤ï¼ˆä¸€éƒ¨ã§ä½¿ç”¨ï¼‰
â”‚   â”‚   â””â”€â”€ notificationService.ts
â”‚   â”œâ”€â”€ constants/                # å®šæ•°å®šç¾©
â”‚   â”‚   â”œâ”€â”€ venues.ts
â”‚   â”‚   â””â”€â”€ external.ts
â”‚   â””â”€â”€ utils/                    # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
â”‚
â””â”€â”€ public/                       # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
```

### 2.3 ãƒ«ãƒ¼ãƒˆã‚°ãƒ«ãƒ¼ãƒ—ã®æ„å›³

Next.jsã®**Route Groups** `(name)` ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¨èªè¨¼å¢ƒç•Œã‚’åˆ†é›¢ã—ã¦ã„ã¾ã™ã€‚

| ãƒ«ãƒ¼ãƒˆã‚°ãƒ«ãƒ¼ãƒ— | ç›®çš„ | ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ |
|--------------|------|-----------|
| `(auth)` | èªè¨¼ãŒå¿…è¦ãªãƒšãƒ¼ã‚¸ | èªè¨¼ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ |
| `(dashboard)` | ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ãƒ»ä¼šå ´ç®¡ç†è€…ç”¨ | ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ |
| `(guest)` | ã‚²ã‚¹ãƒˆç”¨ | ã‚²ã‚¹ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ |
| `(entry)` | ã‚²ã‚¹ãƒˆå…¥å£ï¼ˆãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰èªè¨¼å‰ï¼‰ | ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ |
| `(onboarding)` | ã‚²ã‚¹ãƒˆã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰ | ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ |
| `(main)` | ã‚²ã‚¹ãƒˆãƒ¡ã‚¤ãƒ³æ©Ÿèƒ½ï¼ˆã‚®ãƒ£ãƒ©ãƒªãƒ¼ï¼‰ | ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ |

**ä¾‹: ã‚²ã‚¹ãƒˆã®ãƒ•ãƒ­ãƒ¼**

```
/guest/(entry)/page.tsx          # ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰å…¥åŠ›
    â†“ (èªè¨¼æˆåŠŸ)
/guest/(onboarding)/survey/page.tsx  # ãƒ¬ãƒ“ãƒ¥ãƒ¼å›ç­”
    â†“ (ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†)
/guest/(main)/gallery/page.tsx   # ã‚®ãƒ£ãƒ©ãƒªãƒ¼é–²è¦§
```

---

## 3. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ« & ã‚¹ã‚­ãƒ¼ãƒ

### 3.1 ERå›³

```mermaid
erDiagram
    Venue ||--o{ Wedding : "has"
    Venue ||--o{ Account : "has"
    Wedding ||--o{ Table : "has"
    Wedding ||--o{ Photo : "has"
    Wedding ||--o{ Guest : "has"
    Wedding ||--o{ Feedback : "has"
    Table ||--o{ Photo : "has"
    Guest ||--o{ Photo : "uploads"
    Guest ||--o{ Feedback : "submits"
    
    Venue {
        string id PK
        string name
        string code
        VenuePlan plan
        VenueStatus status
        string coverImageUrl
        boolean enableLineUnlock
        string guestReviewUrl
        number guestReviewThreshold
    }
    
    Wedding {
        string id PK
        string venueId FK
        string date
        string time
        string hall
        string familyNames
        string welcomeImageUrl
        boolean isLocked
        string lockedAt
        string lockedBy FK
    }
    
    Table {
        string id PK
        string weddingId FK
        string name
        string message
        string photoUrl
        boolean isCompleted
        boolean isSkipped
    }
    
    Photo {
        string id PK
        string weddingId FK
        string tableId FK
        string uploadedBy FK
        string url
        PhotoSource source
        PhotoApprovalStatus approvalStatus
        boolean isFavorite
        string uploadedAt
    }
    
    Guest {
        string id PK
        string weddingId FK
        string tableId FK
        GuestStatus status
        SurveyStatus surveyStatus
        AllergyStatus allergyStatus
        string[] allergies
    }
    
    Feedback {
        string id PK
        string weddingId FK
        string userId FK
        number rating
        string content
        FeedbackSource source
        string createdAt
    }
```

### 3.2 ä¸»è¦ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®è©³ç´°

#### 3.2.1 Venue (ä¼šå ´)

**ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/types/schema.ts` (159-212è¡Œç›®)

**é‡è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰:**

```typescript
interface Venue {
  id: string;
  name: string;
  code: string;                    // URLã«ä½¿ç”¨ã•ã‚Œã‚‹è­˜åˆ¥å­
  plan: VenuePlan;                 // 'LIGHT' | 'STANDARD' | 'PREMIUM'
  status: VenueStatus;            // 'ACTIVE' | 'SUSPENDED' | 'ONBOARDING'
  
  // å‹•çš„è¨­å®šé …ç›®ï¼ˆæ–°è¦è¿½åŠ ï¼‰
  coverImageUrl?: string;          // ã‚²ã‚¹ãƒˆå…¥å£ç”»é¢ã®èƒŒæ™¯ç”»åƒ
  enableLineUnlock?: boolean;      // LINEé€£æºã«ã‚ˆã‚‹æŠ•ç¨¿åˆ¶é™è§£é™¤æ©Ÿèƒ½ã®æœ‰åŠ¹/ç„¡åŠ¹
  
  // ãƒ¬ãƒ“ãƒ¥ãƒ¼è¨­å®š
  guestReviewUrl?: string;         // ã‚²ã‚¹ãƒˆå‘ã‘ãƒ¬ãƒ“ãƒ¥ãƒ¼æŠ•ç¨¿URL
  guestReviewThreshold?: number;    // å¤–éƒ¨èª˜å°ã™ã‚‹æœ€ä½æ˜Ÿæ•°
  coupleReviewUrl?: string;         // æ–°éƒæ–°å©¦å‘ã‘ãƒ¬ãƒ“ãƒ¥ãƒ¼æŠ•ç¨¿URL
  coupleReviewThreshold?: number;   // æ–°éƒæ–°å©¦å‘ã‘å¤–éƒ¨èª˜å°ã®æœ€ä½æ˜Ÿæ•°
}
```

**ä½¿ç”¨ç®‡æ‰€:**
- `app/(guest)/guest/(main)/gallery/page.tsx`: `coverImageUrl` ã‚’èƒŒæ™¯ç”»åƒã¨ã—ã¦ä½¿ç”¨
- `app/(guest)/guest/(main)/gallery/page.tsx`: `enableLineUnlock` ã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰åˆ¶é™ãƒ­ã‚¸ãƒƒã‚¯ã‚’åˆ†å²

#### 3.2.2 Wedding (æŒ™å¼)

**ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/types/schema.ts` (232-289è¡Œç›®)

**é‡è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰:**

```typescript
interface Wedding {
  id: string;
  date: string;                    // ISO 8601å½¢å¼ã®æ—¥ä»˜
  time: string;                    // HH:mmå½¢å¼
  hall: string;                    // ä¼šå ´åï¼ˆãƒ›ãƒ¼ãƒ«åï¼‰
  familyNames: string;             // æ–°éƒæ–°å©¦ã®å®¶æ—åï¼ˆè¡¨ç¤ºç”¨ï¼‰
  
  // å‹•çš„è¨­å®šé …ç›®ï¼ˆæ–°è¦è¿½åŠ ï¼‰
  welcomeImageUrl?: string;        // ã‚®ãƒ£ãƒ©ãƒªãƒ¼ç”»é¢ã®èƒŒæ™¯ç”»åƒ
  
  // ãƒ­ãƒƒã‚¯æ©Ÿèƒ½
  isLocked: boolean;               // ãƒ‡ãƒ¼ã‚¿ç¢ºå®šï¼ˆãƒ­ãƒƒã‚¯ï¼‰ã•ã‚Œã¦ã„ã‚‹ã‹
  lockedAt: string | null;         // ãƒ­ãƒƒã‚¯æ—¥æ™‚
  lockedBy: string | null;         // ãƒ­ãƒƒã‚¯ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ID
  
  venueId?: string;                // ä¼šå ´IDï¼ˆå°†æ¥çš„ã«è¿½åŠ äºˆå®šï¼‰
}
```

**ä½¿ç”¨ç®‡æ‰€:**
- `app/couple/layout.tsx`: `welcomeImageUrl` ã‚’ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®èƒŒæ™¯ã¨ã—ã¦ä½¿ç”¨
- `app/couple/page.tsx`: æŒ™å¼æ—¥ã‚’ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³è¡¨ç¤º

#### 3.2.3 Table (å“)

**ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/types/schema.ts` (303-333è¡Œç›®)

**é‡è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰:**

```typescript
interface Table {
  id: string;
  name: string;                    // å“åï¼ˆä¾‹: "A", "B", "1", "2"ï¼‰
  message: string;                  // æ–°éƒæ–°å©¦ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  photoUrl: string | null;         // å“ç”¨ã®å†™çœŸURL
  isCompleted: boolean;            // å®Œäº†çŠ¶æ…‹ï¼ˆå†™çœŸãƒ»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¨­å®šæ¸ˆã¿ã‹ï¼‰
  isSkipped: boolean;              // ã‚¹ã‚­ãƒƒãƒ—æ¸ˆã¿ã‹ï¼ˆå…±é€šå†™çœŸã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼‰
  weddingId: string;              // æŒ™å¼IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰
}
```

**ä½¿ç”¨ç®‡æ‰€:**
- `app/couple/tables/page.tsx`: å“è¨­å®šç”»é¢ã§ç·¨é›†
- `app/(guest)/guest/(main)/gallery/page.tsx`: å“ã”ã¨ã®ã‚¢ãƒ«ãƒãƒ ã‚¿ãƒ–ã§è¡¨ç¤º

#### 3.2.4 Photo (å†™çœŸ)

**ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/types/schema.ts` (382-421è¡Œç›®)

**é‡è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰:**

```typescript
interface Photo {
  id: string;
  url: string;                     // ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä¸Šã®ãƒ‘ã‚¹ã¾ãŸã¯URL
  alt?: string;                    // å†™çœŸã®èª¬æ˜ãƒ»ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³
  source: PhotoSource;             // 'couple' | 'guest' | 'table'
  weddingId: string;              // æŒ™å¼IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰
  tableId: string | null;          // å“IDï¼ˆå“ã”ã¨ã®å†™çœŸã®å ´åˆã€å…¨å“¡å‘ã‘ã®å ´åˆã¯ nullï¼‰
  uploadedBy: string;             // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰
  approvalStatus?: PhotoApprovalStatus;  // 'pending' | 'approved' | 'rejected'
  isFavorite?: boolean;            // ãŠæ°—ã«å…¥ã‚Šãƒ•ãƒ©ã‚°ï¼ˆæ–°éƒæ–°å©¦ãŒãŠæ°—ã«å…¥ã‚Šã«ã—ãŸã‹ï¼‰
  isMyPhoto?: boolean;            // è‡ªåˆ†ã®å†™çœŸã‹ï¼ˆã‚²ã‚¹ãƒˆå´ã®UIç”¨ãƒ•ãƒ©ã‚°ï¼‰
  uploadedAt: string;             // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ—¥æ™‚ï¼ˆISO 8601å½¢å¼ï¼‰
}
```

**ä½¿ç”¨ç®‡æ‰€:**
- `app/(guest)/guest/(main)/gallery/page.tsx`: ã‚²ã‚¹ãƒˆãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»é–²è¦§
- `app/couple/gallery/page.tsx`: æ–°éƒæ–°å©¦ãŒé–²è¦§ãƒ»ãŠæ°—ã«å…¥ã‚Šç™»éŒ²

#### 3.2.5 Guest (ã‚²ã‚¹ãƒˆ)

**ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/types/schema.ts` (68-94è¡Œç›®)

**é‡è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰:**

```typescript
interface Guest extends User {
  role: 'GUEST';
  weddingId: string;              // æŒ™å¼IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰
  tableId: string | null;         // å“IDï¼ˆé…å¸­ç¢ºå®šå‰ã¯ nullï¼‰
  status: GuestStatus;            // 'pending' | 'confirmed' | 'locked'
  surveyStatus: SurveyStatus;    // 'not_answered' | 'answered' | 'approved'
  allergyStatus: AllergyStatus;  // 'none' | 'reported' | 'confirmed'
  allergies: string[];           // ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼æƒ…å ±ï¼ˆæ–‡å­—åˆ—é…åˆ—ï¼‰
}
```

**ä½¿ç”¨ç®‡æ‰€:**
- `app/(guest)/guest/(onboarding)/survey/page.tsx`: ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†å¾Œã« `surveyStatus` ã‚’æ›´æ–°

---

## 4. ä¸»è¦æ©Ÿèƒ½ã®ãƒ­ã‚¸ãƒƒã‚¯è§£èª¬

### 4.1 å³æ ¼ãªãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚²ãƒ¼ãƒˆæ©Ÿèƒ½

**ãƒ•ã‚¡ã‚¤ãƒ«**: `app/(guest)/guest/(onboarding)/survey/page.tsx`

#### 4.1.1 ãƒ•ãƒ­ãƒ¼å›³

```mermaid
stateDiagram-v2
    [*] --> locked: åˆæœŸçŠ¶æ…‹
    locked --> rating: 1ç§’å¾Œï¼ˆè‡ªå‹•é·ç§»ï¼‰
    rating --> action: æ˜Ÿè©•ä¾¡ã‚¯ãƒªãƒƒã‚¯
    action --> unlocking: ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
    unlocking --> redirecting: ãƒ­ãƒƒã‚¯è§£é™¤ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†
    redirecting --> [*]: ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã¸é·ç§»
    
    note right of locked
        éµã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º
        ã€Œã‚®ãƒ£ãƒ©ãƒªãƒ¼ã¸ã€ãƒœã‚¿ãƒ³ã¯éè¡¨ç¤º
    end note
    
    note right of action
        é«˜è©•ä¾¡(4-5): å¤–éƒ¨URLèª˜å°
        ä½è©•ä¾¡(1-3): å†…éƒ¨ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
    end note
    
    note right of unlocking
        éµãŒé–‹ãã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        ç´™å¹é›ªã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
        ã€Œã‚®ãƒ£ãƒ©ãƒªãƒ¼ã¸é€²ã‚€ã€ãƒœã‚¿ãƒ³è¡¨ç¤º
    end note
```

#### 4.1.2 å®Ÿè£…ã®è©³ç´°

**ã‚¹ãƒ†ãƒƒãƒ—å®šç¾©:**

```typescript
type Step = 'locked' | 'rating' | 'action' | 'unlocking' | 'redirecting';
```

**è¨­å®šå€¤ï¼ˆä¼šå ´ã”ã¨ã«å¤‰æ›´å¯èƒ½ï¼‰:**

```typescript
const REVIEW_CONFIG = {
  url: 'https://maps.google.com/?q=è¡¨å‚é“ãƒ†ãƒ©ã‚¹',  // ãƒ¬ãƒ“ãƒ¥ãƒ¼æŠ•ç¨¿å…ˆURL
  minRatingForExternal: 4,  // å¤–éƒ¨èª˜å°ã™ã‚‹æœ€ä½æ˜Ÿæ•°ï¼ˆ4ä»¥ä¸Šãªã‚‰å¤–éƒ¨ã€3ä»¥ä¸‹ãªã‚‰å†…éƒ¨ï¼‰
} as const;
```

**åˆ†å²ãƒ­ã‚¸ãƒƒã‚¯:**

```typescript
// è©•ä¾¡ãŒé«˜ã„å ´åˆï¼ˆè¨­å®šå€¤ä»¥ä¸Šï¼‰ã¯å¤–éƒ¨èª˜å°ã‚ã‚Šã€ä½ã„å ´åˆï¼ˆè¨­å®šå€¤æœªæº€ï¼‰ã¯å†…éƒ¨ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®ã¿
const isHighRating = rating >= REVIEW_CONFIG.minRatingForExternal;

// é«˜è©•ä¾¡ã®å ´åˆ: å¤–éƒ¨ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚µã‚¤ãƒˆã¸èª˜å°
if (isHighRating) {
  window.open(REVIEW_CONFIG.url, '_blank');
  showUnlockAnimation();  // ãƒ­ãƒƒã‚¯è§£é™¤ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
} else {
  // ä½è©•ä¾¡ã®å ´åˆ: å†…éƒ¨ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’é€ä¿¡
  await submitReview(weddingId, userId, rating, feedbackText);
  showUnlockAnimation();
}
```

**é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ:**

1. **ã€Œã‚®ãƒ£ãƒ©ãƒªãƒ¼ã¸é€²ã‚€ã€ãƒœã‚¿ãƒ³ã¯ `unlocking` ã‚¹ãƒ†ãƒƒãƒ—ã§åˆã‚ã¦è¡¨ç¤ºã•ã‚Œã‚‹**
   - `locked`, `rating`, `action` ã‚¹ãƒ†ãƒƒãƒ—ã§ã¯éè¡¨ç¤º
   - ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆå¤–éƒ¨URLé–‹ã or ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯é€ä¿¡ï¼‰ã‚’å®Ÿè¡Œã—ãŸå¾Œã«ã®ã¿è¡¨ç¤º

2. **LocalStorageã«ã‚ˆã‚‹çŠ¶æ…‹ç®¡ç†:**
   ```typescript
   const getReviewStorageKey = (guestId?: string) => {
     return `wedding_app_review_completed_${guestId || 'default'}`;
   };
   ```
   - ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†çŠ¶æ…‹ã‚’LocalStorageã«ä¿å­˜
   - æ¬¡å›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã«ã‚¹ã‚­ãƒƒãƒ—å¯èƒ½ï¼ˆå®Ÿè£…äºˆå®šï¼‰

3. **ç´™å¹é›ªã‚¨ãƒ•ã‚§ã‚¯ãƒˆ:**
   - `canvas-confetti` ã‚’ä½¿ç”¨ã—ã¦ãƒ­ãƒƒã‚¯è§£é™¤æ™‚ã«è¦–è¦šçš„ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’æä¾›

### 4.2 å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ & LINEé€£æºåˆ¶é™

**ãƒ•ã‚¡ã‚¤ãƒ«**: `app/(guest)/guest/(main)/gallery/page.tsx`

#### 4.2.1 ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æšæ•°åˆ¶é™ãƒ­ã‚¸ãƒƒã‚¯

**åˆ¶é™ãƒ«ãƒ¼ãƒ«:**
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: **5æšã¾ã§**ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¯èƒ½
- `enableLineUnlock === true` ã®å ´åˆ: LINEé€£æºã§åˆ¶é™è§£é™¤å¯èƒ½
- `enableLineUnlock === false` ã®å ´åˆ: 5æšã§ãƒãƒ¼ãƒ‰ãƒªãƒŸãƒƒãƒˆ

**å®Ÿè£…:**

```typescript
// ä¼šå ´è¨­å®šã®èª­ã¿è¾¼ã¿
const [venueInfo, setVenueInfo] = useState<{
  name: string;
  coverImage: string;
  enableLineUnlock: boolean;
} | null>(null);

useEffect(() => {
  const loadData = async () => {
    const venue = await getVenueInfo(MOCK_VENUE_ID);
    setVenueInfo({
      name: venue.name,
      coverImage: venue.coverImageUrl || '...',
      enableLineUnlock: venue.enableLineUnlock || false,
    });
  };
  loadData();
}, []);

// ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠæ™‚ã®åˆ¶é™ãƒã‚§ãƒƒã‚¯
const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {
  const files = Array.from(e.target.files || []);
  
  // æšæ•°åˆ¶é™ãƒã‚§ãƒƒã‚¯
  if (uploadedCount + files.length > 5) {
    if (venueInfo?.enableLineUnlock) {
      // LINEé€£æºãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
      setShowLimitModal(true);
    } else {
      // ã‚¨ãƒ©ãƒ¼ãƒˆãƒ¼ã‚¹ãƒˆã‚’è¡¨ç¤ºï¼ˆãƒãƒ¼ãƒ‰ãƒªãƒŸãƒƒãƒˆï¼‰
      toast.error('ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ã€‚æŠ•ç¨¿æšæ•°ã®ä¸Šé™ï¼ˆ5æšï¼‰ã«é”ã—ã¾ã—ãŸã€‚');
    }
    return;
  }
  
  // ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒã‚§ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
  setShowComplianceModal(true);
  setSelectedFiles(files);
};
```

**UIã®æ¡ä»¶åˆ†å²:**

```typescript
{/* LINEé€£æºãƒœã‚¿ãƒ³ï¼ˆenableLineUnlockãŒtrueã®å ´åˆã®ã¿è¡¨ç¤ºï¼‰ */}
{venueInfo?.enableLineUnlock && (
  <button onClick={handleLineConnect}>
    LINEé€£æºã§ç„¡åˆ¶é™ã«ã™ã‚‹
  </button>
)}

{/* ä¸Šé™åˆ°é”æ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */}
{uploadedCount >= 5 && !venueInfo?.enableLineUnlock && (
  <p>æŠ•ç¨¿æšæ•°ã®ä¸Šé™ã«é”ã—ã¾ã—ãŸ</p>
)}
```

### 4.3 ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½

**ãƒ•ã‚¡ã‚¤ãƒ«**: `app/couple/gallery/page.tsx`

#### 4.3.1 å˜ä¸€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆã‚¹ãƒãƒ›å¯¾å¿œï¼‰

**å„ªå…ˆé †ä½:**
1. **Web Share API** (ãƒ¢ãƒã‚¤ãƒ«ç«¯æœ«)
2. **Blobå½¢å¼ã§ã®å¼·åˆ¶ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰** (PC/éå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶)

**å®Ÿè£…:**

```typescript
const executeDownload = async (photoUrl: string, photoId: string) => {
  try {
    // 1. Web Share APIã‚’è©¦è¡Œï¼ˆãƒ¢ãƒã‚¤ãƒ«ç«¯æœ«ï¼‰
    if (navigator.share) {
      const response = await fetch(photoUrl);
      const blob = await response.blob();
      const file = new File([blob], `photo-${photoId}.jpg`, { type: blob.type });
      
      await navigator.share({
        files: [file],
        title: 'å†™çœŸã‚’å…±æœ‰',
      });
      return;
    }
    
    // 2. Blobå½¢å¼ã§ã®å¼·åˆ¶ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆPC/éå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶ï¼‰
    const response = await fetch(photoUrl);
    const blob = await response.blob();
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `photo-${photoId}.jpg`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
  } catch (error: unknown) {
    if (error instanceof Error && error.name !== 'AbortError') {
      console.warn('Web Share API failed, falling back to blob download:', error);
      // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†
    }
  }
};
```

#### 4.3.2 ä¸€æ‹¬ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆZIPåœ§ç¸®ï¼‰

**å®Ÿè£…:**

```typescript
const executeBulkDownload = async () => {
  const loadingToastId = toast.loading('ZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆä¸­...');
  
  try {
    const zip = new JSZip();
    const photosToDownload = photos;  // é¸æŠã•ã‚ŒãŸå†™çœŸã¾ãŸã¯å…¨ã¦ã®å†™çœŸ
    
    // å…¨ã¦ã®ç”»åƒã‚’ä¸¦åˆ—ã§å–å¾—ã—ã¦ZIPã«è¿½åŠ 
    const fetchPromises = photosToDownload.map(async (photo, index) => {
      try {
        const response = await fetch(photo.url);
        const blob = await response.blob();
        const filename = `photo-${photo.id || index + 1}.jpg`;
        zip.file(filename, blob);
      } catch (error) {
        console.warn(`Failed to fetch photo ${photo.id}:`, error);
      }
    });
    
    await Promise.allSettled(fetchPromises);
    
    // ZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
    const zipBlob = await zip.generateAsync({ 
      type: 'blob',
      compression: 'DEFLATE',
      compressionOptions: { level: 6 },
    });
    
    // file-saverã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
    const filename = `wedding-photos-${new Date().toISOString().split('T')[0]}.zip`;
    saveAs(zipBlob, filename);
    
    toast.success('ZIPãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’é–‹å§‹ã—ã¾ã—ãŸ', {
      id: loadingToastId,
      description: `${photosToDownload.length}æšã®å†™çœŸãŒå«ã¾ã‚Œã¦ã„ã¾ã™`,
    });
  } catch (error) {
    toast.error('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ', { id: loadingToastId });
  }
};
```

### 4.4 å…¥å®¤ãƒ•ãƒ­ãƒ¼ï¼ˆãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰èªè¨¼ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `app/(guest)/guest/(entry)/page.tsx`

#### 4.4.1 ãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant G as Guest
    participant E as Entry Page
    participant A as Auth Logic
    participant S as Survey Page
    
    G->>E: ä¼šå ´é¸æŠ
    E->>E: æŒ™å¼é¸æŠ
    E->>E: ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰å…¥åŠ›ï¼ˆ4æ¡ï¼‰
    E->>A: ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰æ¤œè¨¼
    alt èªè¨¼æˆåŠŸ
        A->>E: éµãŒé–‹ãã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        E->>S: /guest/survey ã¸é·ç§»
    else èªè¨¼å¤±æ•—
        A->>E: ã‚·ã‚§ã‚¤ã‚¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        E->>E: ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ã‚¯ãƒªã‚¢
    end
```

#### 4.4.2 å®Ÿè£…ã®è©³ç´°

**ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰æ¤œè¨¼:**

```typescript
useEffect(() => {
  if (passcode.length === 4 && selectedWedding && !isUnlocking && !isUnlocked) {
    setIsUnlocking(true);
    
    // èªè¨¼å‡¦ç†ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå®Ÿéš›ã¯APIå‘¼ã³å‡ºã—ï¼‰
    setTimeout(() => {
      if (passcode === selectedWedding.passcode) {
        setIsUnlocked(true);
        setTimeout(() => {
          router.push('/guest/survey');
        }, 1500);
      } else {
        setIsUnlocking(false);
        setShake(true);
        setTimeout(() => {
          setShake(false);
          setPasscode('');
        }, 600);
      }
    }, 500);
  }
}, [passcode, selectedWedding, isUnlocking, isUnlocked]);
```

**æ³¨æ„**: ç¾åœ¨ã¯ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã§å‹•ä½œã—ã¦ã„ã¾ã™ã€‚å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã§ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’æ¤œè¨¼ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

---

## 5. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é–‹ç™ºè€…ã¸ã®å®Ÿè£…ã‚¬ã‚¤ãƒ‰

### 5.1 Serviceå±¤ã®å®Ÿè£…æ–¹é‡

**ç¾åœ¨ã®çŠ¶æ…‹:**
- `lib/services/mock/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®ã™ã¹ã¦ã®é–¢æ•°ãŒãƒ¢ãƒƒã‚¯å®Ÿè£…
- å„é–¢æ•°ã« `BACKEND_TODO` ã‚³ãƒ¡ãƒ³ãƒˆãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹
- UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯æ—¢ã«Serviceå±¤ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã€**Serviceå±¤ã®å®Ÿè£…ã®ã¿ã§ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é€£æºãŒå®Œäº†**

### 5.2 å®Ÿè£…ãŒå¿…è¦ãªServiceé–¢æ•°ä¸€è¦§

#### 5.2.1 Wedding Service (`lib/services/mock/weddingService.ts`)

| é–¢æ•°å | å¼•æ•° | æˆ»ã‚Šå€¤ | APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | DBãƒ†ãƒ¼ãƒ–ãƒ« |
|--------|------|--------|------------------|-----------|
| `getWeddingInfo` | `weddingId: string` | `Promise<Wedding>` | `GET /api/weddings/:weddingId` | `weddings` |
| `updateWelcomeMessage` | `weddingId: string, welcomeImageUrl: string` | `Promise<Wedding>` | `PATCH /api/weddings/:weddingId` | `weddings` + Storage |
| `getWeddingTables` | `weddingId: string` | `Promise<Table[]>` | `GET /api/weddings/:weddingId/tables` | `tables` |
| `getWeddingDate` | `weddingId: string` | `Promise<Date>` | `GET /api/weddings/:weddingId` | `weddings` |

**å®Ÿè£…ä¾‹:**

```typescript
// lib/services/mock/weddingService.ts ã‚’ lib/services/weddingService.ts ã«ãƒªãƒãƒ¼ãƒ å¾Œ

export async function getWeddingInfo(weddingId: string): Promise<Wedding> {
  const response = await fetch(`/api/weddings/${weddingId}`, {
    headers: {
      'Authorization': `Bearer ${getAuthToken()}`,  // èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³
    },
  });
  
  if (!response.ok) {
    throw new Error(`Failed to fetch wedding: ${response.statusText}`);
  }
  
  return response.json();
}
```

**Storageå®Ÿè£…ï¼ˆ`updateWelcomeMessage`ï¼‰:**

```typescript
export async function updateWelcomeMessage(
  weddingId: string,
  welcomeImageUrl: string
): Promise<Wedding> {
  // 1. ç”»åƒã‚’Supabase Storageã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
  const file = await fetch(welcomeImageUrl).then(r => r.blob());
  const fileName = `wedding-${weddingId}-welcome-${Date.now()}.jpg`;
  const { data: uploadData, error: uploadError } = await supabase.storage
    .from('wedding-welcome-images')
    .upload(fileName, file);
  
  if (uploadError) throw uploadError;
  
  // 2. å…¬é–‹URLã‚’å–å¾—
  const { data: { publicUrl } } = supabase.storage
    .from('wedding-welcome-images')
    .getPublicUrl(fileName);
  
  // 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ›´æ–°
  const response = await fetch(`/api/weddings/${weddingId}`, {
    method: 'PATCH',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${getAuthToken()}`,
    },
    body: JSON.stringify({ welcomeImageUrl: publicUrl }),
  });
  
  if (!response.ok) {
    throw new Error(`Failed to update wedding: ${response.statusText}`);
  }
  
  return response.json();
}
```

#### 5.2.2 Venue Service (`lib/services/mock/venueService.ts`)

| é–¢æ•°å | å¼•æ•° | æˆ»ã‚Šå€¤ | APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | DBãƒ†ãƒ¼ãƒ–ãƒ« |
|--------|------|--------|------------------|-----------|
| `getVenueInfo` | `venueId: string` | `Promise<Venue>` | `GET /api/venues/:venueId` | `venues` |
| `updateVenueSettings` | `venueId: string, updates: Partial<Venue>` | `Promise<Venue>` | `PATCH /api/venues/:venueId` | `venues` |

**å®Ÿè£…ä¾‹:**

```typescript
export async function getVenueInfo(venueId: string): Promise<Venue> {
  const response = await fetch(`/api/venues/${venueId}`, {
    headers: {
      'Authorization': `Bearer ${getAuthToken()}`,
    },
  });
  
  if (!response.ok) {
    throw new Error(`Failed to fetch venue: ${response.statusText}`);
  }
  
  return response.json();
}
```

#### 5.2.3 Photo Service (`lib/services/mock/photoService.ts`)

| é–¢æ•°å | å¼•æ•° | æˆ»ã‚Šå€¤ | APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | Storage | DBãƒ†ãƒ¼ãƒ–ãƒ« |
|--------|------|--------|------------------|---------|-----------|
| `uploadPhoto` | `file: File, weddingId: string, tableId: string \| null, uploaderId: string` | `Promise<Photo>` | `POST /api/photos` | `wedding-photos/:weddingId/:tableId/` | `photos` |
| `uploadPhotos` | `files: File[], weddingId: string, tableId: string \| null, uploaderId: string` | `Promise<Photo[]>` | `POST /api/photos/batch` | åŒä¸Š | `photos` |
| `getPhotosByTable` | `tableId: string` | `Promise<Photo[]>` | `GET /api/tables/:tableId/photos` | - | `photos` |
| `getPhotosByWedding` | `weddingId: string` | `Promise<Photo[]>` | `GET /api/weddings/:weddingId/photos` | - | `photos` |
| `deletePhoto` | `photoId: string, userId: string` | `Promise<boolean>` | `DELETE /api/photos/:photoId` | Storageå‰Šé™¤ | `photos` |
| `togglePhotoFavorite` | `photoId: string, isFavorite: boolean` | `Promise<Photo>` | `PATCH /api/photos/:photoId/favorite` | - | `photos` |

**å®Ÿè£…ä¾‹ï¼ˆ`uploadPhoto`ï¼‰:**

```typescript
export async function uploadPhoto(
  file: File,
  weddingId: string,
  tableId: string | null,
  uploaderId: string
): Promise<Photo> {
  // 1. Supabase Storageã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
  const fileName = `${weddingId}/${tableId || 'all'}/${Date.now()}-${file.name}`;
  const { data: uploadData, error: uploadError } = await supabase.storage
    .from('wedding-photos')
    .upload(fileName, file);
  
  if (uploadError) throw uploadError;
  
  // 2. å…¬é–‹URLã‚’å–å¾—
  const { data: { publicUrl } } = supabase.storage
    .from('wedding-photos')
    .getPublicUrl(fileName);
  
  // 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆ
  const response = await fetch('/api/photos', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${getAuthToken()}`,
    },
    body: JSON.stringify({
      url: publicUrl,
      weddingId,
      tableId,
      uploadedBy: uploaderId,
      source: tableId ? 'table' : 'guest',
      approvalStatus: 'approved',  // ã¾ãŸã¯ 'pending'ï¼ˆæ‰¿èªãƒ•ãƒ­ãƒ¼ãŒã‚ã‚‹å ´åˆï¼‰
    }),
  });
  
  if (!response.ok) {
    throw new Error(`Failed to upload photo: ${response.statusText}`);
  }
  
  return response.json();
}
```

#### 5.2.4 Guest Service (`lib/services/mock/guestService.ts`)

| é–¢æ•°å | å¼•æ•° | æˆ»ã‚Šå€¤ | APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | DBãƒ†ãƒ¼ãƒ–ãƒ« |
|--------|------|--------|------------------|-----------|
| `submitReview` | `weddingId: string, userId: string, rating: number, content?: string` | `Promise<Feedback>` | `POST /api/feedbacks` | `feedbacks` |
| `unlockGallery` | `guestId: string` | `Promise<Guest>` | `POST /api/guests/:guestId/unlock-gallery` | `guests` |
| `getGuestInfo` | `guestId: string` | `Promise<Guest>` | `GET /api/guests/:guestId` | `guests` |

**å®Ÿè£…ä¾‹ï¼ˆ`submitReview`ï¼‰:**

```typescript
export async function submitReview(
  weddingId: string,
  userId: string,
  rating: number,
  content?: string
): Promise<Feedback> {
  const response = await fetch('/api/feedbacks', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${getAuthToken()}`,
    },
    body: JSON.stringify({
      weddingId,
      userId,
      rating,
      content: content || '',
      source: 'GUEST',
    }),
  });
  
  if (!response.ok) {
    throw new Error(`Failed to submit review: ${response.statusText}`);
  }
  
  return response.json();
}
```

### 5.3 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒæ¨å¥¨

**ä¸»è¦ãƒ†ãƒ¼ãƒ–ãƒ«:**

```sql
-- ä¼šå ´ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE venues (
  id VARCHAR(255) PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  code VARCHAR(255) UNIQUE NOT NULL,
  plan VARCHAR(50) NOT NULL,  -- 'LIGHT', 'STANDARD', 'PREMIUM'
  status VARCHAR(50) NOT NULL,  -- 'ACTIVE', 'SUSPENDED', 'ONBOARDING'
  cover_image_url TEXT,
  enable_line_unlock BOOLEAN DEFAULT false,
  guest_review_url TEXT,
  guest_review_threshold INTEGER DEFAULT 4,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- æŒ™å¼ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE weddings (
  id VARCHAR(255) PRIMARY KEY,
  venue_id VARCHAR(255) REFERENCES venues(id),
  date DATE NOT NULL,
  time VARCHAR(10) NOT NULL,  -- HH:mmå½¢å¼
  hall VARCHAR(255) NOT NULL,
  family_names VARCHAR(255) NOT NULL,
  welcome_image_url TEXT,
  is_locked BOOLEAN DEFAULT false,
  locked_at TIMESTAMP,
  locked_by VARCHAR(255),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- å“ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE tables (
  id VARCHAR(255) PRIMARY KEY,
  wedding_id VARCHAR(255) NOT NULL REFERENCES weddings(id),
  name VARCHAR(50) NOT NULL,
  message TEXT DEFAULT '',
  photo_url TEXT,
  is_completed BOOLEAN DEFAULT false,
  is_skipped BOOLEAN DEFAULT false,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- å†™çœŸãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE photos (
  id VARCHAR(255) PRIMARY KEY,
  wedding_id VARCHAR(255) NOT NULL REFERENCES weddings(id),
  table_id VARCHAR(255) REFERENCES tables(id),
  uploaded_by VARCHAR(255) NOT NULL,  -- ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
  url TEXT NOT NULL,  -- Storageä¸Šã®URL
  alt TEXT,
  source VARCHAR(50) NOT NULL,  -- 'couple', 'guest', 'table'
  approval_status VARCHAR(50) DEFAULT 'pending',  -- 'pending', 'approved', 'rejected'
  is_favorite BOOLEAN DEFAULT false,
  uploaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ã‚²ã‚¹ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE guests (
  id VARCHAR(255) PRIMARY KEY,
  wedding_id VARCHAR(255) NOT NULL REFERENCES weddings(id),
  table_id VARCHAR(255) REFERENCES tables(id),
  name VARCHAR(255) NOT NULL,
  email VARCHAR(255) NOT NULL,
  status VARCHAR(50) DEFAULT 'pending',  -- 'pending', 'confirmed', 'locked'
  survey_status VARCHAR(50) DEFAULT 'not_answered',  -- 'not_answered', 'answered', 'approved'
  allergy_status VARCHAR(50) DEFAULT 'none',  -- 'none', 'reported', 'confirmed'
  allergies TEXT[],  -- PostgreSQLé…åˆ—å‹
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE feedbacks (
  id VARCHAR(255) PRIMARY KEY,
  wedding_id VARCHAR(255) NOT NULL REFERENCES weddings(id),
  user_id VARCHAR(255) NOT NULL,
  rating INTEGER NOT NULL CHECK (rating >= 1 AND rating <= 5),
  content TEXT DEFAULT '',
  source VARCHAR(50) NOT NULL,  -- 'COUPLE', 'GUEST'
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ¨å¥¨:**

```sql
CREATE INDEX idx_photos_wedding_id ON photos(wedding_id);
CREATE INDEX idx_photos_table_id ON photos(table_id);
CREATE INDEX idx_photos_uploaded_by ON photos(uploaded_by);
CREATE INDEX idx_tables_wedding_id ON tables(wedding_id);
CREATE INDEX idx_guests_wedding_id ON guests(wedding_id);
CREATE INDEX idx_guests_table_id ON guests(table_id);
CREATE INDEX idx_feedbacks_wedding_id ON feedbacks(wedding_id);
```

### 5.4 å®Ÿè£…æ‰‹é †

1. **`lib/services/mock/` ã‚’ `lib/services/` ã«ãƒªãƒãƒ¼ãƒ **
   ```bash
   mv lib/services/mock lib/services/real
   ```

2. **å„Serviceãƒ•ã‚¡ã‚¤ãƒ«ã® `BACKEND_TODO` ã‚³ãƒ¡ãƒ³ãƒˆã‚’å®Ÿè£…ã«ç½®ãæ›ãˆ**

3. **ç’°å¢ƒå¤‰æ•°ã®è¨­å®š**
   - APIãƒ™ãƒ¼ã‚¹URL
   - èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®å–å¾—æ–¹æ³•
   - Storageè¨­å®šï¼ˆSupabaseç­‰ï¼‰

4. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®è¿½åŠ **
   - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼
   - èªè¨¼ã‚¨ãƒ©ãƒ¼
   - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼

5. **å‹å®šç¾©ã®ç¢ºèª**
   - `lib/types/schema.ts` ã®å‹å®šç¾©ã¨APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒä¸€è‡´ã—ã¦ã„ã‚‹ã‹ç¢ºèª

---

## 6. ç’°å¢ƒå¤‰æ•° & è¨­å®š

### 6.1 ç’°å¢ƒå¤‰æ•°ï¼ˆ`.env.local`ï¼‰

**ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³**: ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã¯å­˜åœ¨ã—ã¾ã›ã‚“ï¼ˆæœªå®Ÿè£…ï¼‰

**æ¨å¥¨ã•ã‚Œã‚‹ç’°å¢ƒå¤‰æ•°:**

```bash
# APIè¨­å®š
NEXT_PUBLIC_API_BASE_URL=http://localhost:3000/api
NEXT_PUBLIC_API_URL=https://api.example.com

# èªè¨¼è¨­å®š
NEXT_PUBLIC_AUTH_DOMAIN=auth.example.com

# å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹
NEXT_PUBLIC_GOOGLE_MAPS_URL=https://www.google.com/maps
NEXT_PUBLIC_LINE_ID=@your_line_id

# Storageè¨­å®šï¼ˆSupabaseç­‰ï¼‰
NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=xxx
SUPABASE_SERVICE_ROLE_KEY=xxx  # ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®ã¿

# ãã®ä»–
NEXT_PUBLIC_APP_URL=https://app.example.com
```

### 6.2 å®šæ•°ãƒ•ã‚¡ã‚¤ãƒ«

#### 6.2.1 `lib/constants/venues.ts`

```typescript
export const VENUE_INFO: Record<string, VenueInfo> = {
  'venue-001': { id: 'venue-001', name: 'ä¼šå ´A' },
  'venue-002': { id: 'venue-002', name: 'ä¼šå ´B' },
  'venue-003': { id: 'venue-003', name: 'ä¼šå ´C' },
};

export const DEFAULT_VENUE_NAME = 'ä¸æ˜ãªä¼šå ´';
```

**æ³¨æ„**: ç¾åœ¨ã¯ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã™ãŒã€å°†æ¥çš„ã«ã¯APIã‹ã‚‰å–å¾—ã™ã‚‹æƒ³å®šã§ã™ã€‚

#### 6.2.2 `lib/constants/external.ts`

```typescript
export const GOOGLE_MAPS_URL = process.env.NEXT_PUBLIC_GOOGLE_MAPS_URL || 'https://www.google.com/maps';
export const LINE_ID = process.env.NEXT_PUBLIC_LINE_ID || '@ã‚ãªãŸã®LINE_ID';
```

**æ³¨æ„**: ç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾—ã™ã‚‹å®Ÿè£…ã«ãªã£ã¦ã„ã¾ã™ãŒã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚

---

## 7. é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 7.1 å¿…è¦ãªç’°å¢ƒ

- **Node.js**: 18.x ä»¥ä¸Š
- **npm**: 9.x ä»¥ä¸Šï¼ˆã¾ãŸã¯ yarn, pnpmï¼‰

### 7.2 ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

```bash
# 1. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# 2. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•
npm run dev

# 3. ãƒ“ãƒ«ãƒ‰ï¼ˆæœ¬ç•ªç”¨ï¼‰
npm run build

# 4. æœ¬ç•ªã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•
npm start

# 5. Lintãƒã‚§ãƒƒã‚¯
npm run lint
```

### 7.3 é–‹ç™ºã‚µãƒ¼ãƒãƒ¼

- **URL**: `http://localhost:3003`
- **ãƒãƒ¼ãƒˆ**: 3003ï¼ˆ`package.json` ã§è¨­å®šï¼‰

### 7.4 ä¸»è¦ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆ

| ã‚¹ã‚¯ãƒªãƒ—ãƒˆ | èª¬æ˜ |
|-----------|------|
| `npm run dev` | é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•ï¼ˆãƒãƒ¼ãƒˆ3003ã€ãƒ›ã‚¹ãƒˆ0.0.0.0ï¼‰ |
| `npm run build` | æœ¬ç•ªç”¨ãƒ“ãƒ«ãƒ‰ |
| `npm start` | æœ¬ç•ªã‚µãƒ¼ãƒãƒ¼èµ·å‹•ï¼ˆãƒãƒ¼ãƒˆ3003ï¼‰ |
| `npm run lint` | ESLintãƒã‚§ãƒƒã‚¯ |

---

## 8. é‡è¦ãªæ³¨æ„äº‹é …

### 8.1 æœªå®Ÿè£…æ©Ÿèƒ½

ä»¥ä¸‹ã®æ©Ÿèƒ½ã¯**ç¾åœ¨æœªå®Ÿè£…**ã§ã™ï¼š

1. **èªè¨¼ã‚·ã‚¹ãƒ†ãƒ **: ç¾åœ¨ã¯ãƒ¢ãƒƒã‚¯èªè¨¼ã®ã¿
2. **ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰æ¤œè¨¼**: `app/(guest)/guest/(entry)/page.tsx` ã§ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ç”¨
3. **ç’°å¢ƒå¤‰æ•°ã®èª­ã¿è¾¼ã¿**: `.env` ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„
4. **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°**: å†™çœŸã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§åæ˜ ã•ã‚Œãªã„
5. **ç”»åƒæœ€é©åŒ–**: Next.js Imageã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦ã„ãªã„ç®‡æ‰€ãŒã‚ã‚‹

### 8.2 æ—¢çŸ¥ã®åˆ¶é™äº‹é …

1. **ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã®ä½¿ç”¨**: å¤šãã®ç®‡æ‰€ã§ `MOCK_WEDDING_ID` ã‚„ `MOCK_VENUE_ID` ãŒãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹
2. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ä¸€éƒ¨ã®Serviceé–¢æ•°ã§ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒä¸ååˆ†
3. **å‹å®‰å…¨æ€§**: ä¸€éƒ¨ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ `any` å‹ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ï¼ˆä¿®æ­£æ¸ˆã¿ï¼‰

### 8.3 æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é–‹ç™ºè€…å‘ã‘ï¼‰

1. **èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…**
   - JWTèªè¨¼ã¾ãŸã¯Supabase Authã®å°å…¥
   - å„Serviceé–¢æ•°ã«èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¸¡ã™å®Ÿè£…

2. **APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å®Ÿè£…**
   - `lib/services/mock/` å†…ã®å„é–¢æ•°ã«å¯¾å¿œã™ã‚‹APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½œæˆ
   - RESTful APIè¨­è¨ˆã«å¾“ã†

3. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ§‹ç¯‰**
   - ä¸Šè¨˜ã®ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã‚’å‚è€ƒã«ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆ
   - ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®æœ€é©åŒ–

4. **Storageã®è¨­å®š**
   - Supabase Storageã¾ãŸã¯AWS S3ã®è¨­å®š
   - ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»å‰Šé™¤æ©Ÿèƒ½ã®å®Ÿè£…

5. **ç’°å¢ƒå¤‰æ•°ã®è¨­å®š**
   - `.env.local` ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ
   - å„ç’°å¢ƒï¼ˆé–‹ç™ºãƒ»ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ãƒ»æœ¬ç•ªï¼‰ã§ã®è¨­å®š

---

## 9. å‚è€ƒè³‡æ–™

### 9.1 ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

| ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ | èª¬æ˜ |
|------------|------|
| `lib/types/schema.ts` | å…±é€šå‹å®šç¾©ï¼ˆæœ€é‡è¦ï¼‰ |
| `lib/services/mock/weddingService.ts` | æŒ™å¼æƒ…å ±ã®Serviceå±¤ |
| `lib/services/mock/venueService.ts` | ä¼šå ´æƒ…å ±ã®Serviceå±¤ |
| `lib/services/mock/photoService.ts` | å†™çœŸã®Serviceå±¤ |
| `lib/services/mock/guestService.ts` | ã‚²ã‚¹ãƒˆæƒ…å ±ã®Serviceå±¤ |
| `app/(guest)/guest/(onboarding)/survey/page.tsx` | ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚²ãƒ¼ãƒˆæ©Ÿèƒ½ |
| `app/(guest)/guest/(main)/gallery/page.tsx` | ã‚²ã‚¹ãƒˆã‚®ãƒ£ãƒ©ãƒªãƒ¼ |
| `app/couple/tables/page.tsx` | å“è¨­å®šç”»é¢ |
| `app/couple/gallery/page.tsx` | æ–°éƒæ–°å©¦ã‚®ãƒ£ãƒ©ãƒªãƒ¼ |

### 9.2 å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [Next.js App Router](https://nextjs.org/docs/app)
- [Framer Motion](https://www.framer.com/motion/)
- [Shadcn/ui](https://ui.shadcn.com/)
- [Zod](https://zod.dev/)
- [JSZip](https://stuk.github.io/jszip/)
- [file-saver](https://github.com/eligrey/FileSaver.js/)

---

## 10. é€£çµ¡å…ˆãƒ»ã‚µãƒãƒ¼ãƒˆ

**è³ªå•ã‚„ä¸æ˜ç‚¹ãŒã‚ã‚‹å ´åˆ:**
1. ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å†ç¢ºèª
2. å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ï¼ˆç‰¹ã« `lib/types/schema.ts` ã¨ `lib/services/mock/`ï¼‰ã‚’å‚ç…§
3. å¿…è¦ã«å¿œã˜ã¦é–‹ç™ºãƒãƒ¼ãƒ ã«é€£çµ¡

---

**æœ€çµ‚æ›´æ–°**: 2024å¹´12æœˆ  
**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
